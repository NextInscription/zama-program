<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zama Private Transfer SDK - Web Integration Example</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        width: 100%;
        padding: 40px;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .section {
        margin-bottom: 30px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
      }

      .button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .button-secondary {
        background: #f0f0f0;
        color: #333;
      }

      .input-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
      }

      input,
      select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.2s;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
      }

      .info-box {
        background: #f8f9fa;
        border-left: 4px solid #667eea;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        font-size: 14px;
        line-height: 1.6;
      }

      .warning-box {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        font-size: 14px;
        line-height: 1.6;
      }

      .success-box {
        background: #d4edda;
        border-left: 4px solid #28a745;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        font-size: 14px;
        line-height: 1.6;
        word-break: break-all;
      }

      .error-box {
        background: #f8d7da;
        border-left: 4px solid #dc3545;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        font-size: 14px;
        line-height: 1.6;
      }

      .status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 10px;
      }

      .status-connected {
        background: #d4edda;
        color: #155724;
      }

      .status-disconnected {
        background: #f8d7da;
        color: #721c24;
      }

      .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-left: 10px;
        vertical-align: middle;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .code {
        font-family: 'Courier New', monospace;
        background: #f8f9fa;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <!-- Polyfill for Node.js global variables in browser -->
    <script>
      window.global = window.globalThis;
      window.process = window.process || { env: {} };
    </script>

    <div class="container">
      <h1>üîê Zama Private Transfer</h1>
      <p class="subtitle">Web3 SDK Integration Example</p>

      <!-- Connection Section -->
      <div class="section">
        <div class="section-title">
          Connection
          <span id="connectionStatus" class="status status-disconnected">Disconnected</span>
        </div>
        <button id="connectBtn" class="button">Connect MetaMask</button>
        <div id="walletAddress" style="margin-top: 10px; font-size: 14px; color: #666"></div>
      </div>

      <!-- Deposit Section -->
      <div class="section">
        <div class="section-title">Make a Deposit</div>

        <div class="input-group">
          <label>Transfer Type</label>
          <select id="transferType">
            <option value="1">Type 1: Specified Recipient</option>
            <option value="2">Type 2: Anyone with Password</option>
            <option value="3">Type 3: Entrusted Withdrawal (Bounty)</option>
          </select>
        </div>

        <div class="input-group">
          <label>Amount (ETH)</label>
          <input type="number" id="depositAmount" placeholder="0.01" step="0.001" />
        </div>

        <div class="input-group" id="recipientGroup">
          <label>Recipient Address</label>
          <input type="text" id="recipientAddress" placeholder="0x..." />
        </div>

        <button id="depositBtn" class="button" disabled>Make Deposit</button>

        <div id="depositResult"></div>
      </div>

      <!-- Withdraw Section -->
      <div class="section">
        <div class="section-title">Withdraw Funds</div>

        <div class="input-group">
          <label>Password (Private Key or Text)</label>
          <input type="password" id="withdrawPassword" placeholder="Your password" />
        </div>

        <div class="input-group">
          <label>Amount (ETH)</label>
          <input type="number" id="withdrawAmount" placeholder="0.01" step="0.001" />
        </div>

        <button id="checkVaultBtn" class="button button-secondary" disabled>Check Vault</button>
        <button id="withdrawBtn" class="button" disabled>Withdraw</button>

        <div id="withdrawResult"></div>
      </div>

      <!-- Bounty Tasks Section -->
      <div class="section">
        <div class="section-title">Bounty Tasks</div>

        <button id="loadTasksBtn" class="button button-secondary" disabled>
          Load Available Tasks
        </button>

        <div id="tasksResult"></div>
      </div>

      <div class="info-box">
        <strong>‚ÑπÔ∏è About this example:</strong><br />
        This page demonstrates how to integrate the Zama Private Transfer SDK into a web
        application. Make sure you have MetaMask installed and connected to Sepolia testnet.
      </div>
    </div>

    <!-- SDK Import (use the built version in production) -->
    <script type="module">
      // In production, import from npm package:
      // import { PrivateTransferSDK, TransferType } from '@zama-private-transfer/sdk';

      // For this example, we'll assume the SDK is available globally or via import
      let sdk = null;
      let isConnected = false;

      // UI Elements
      const connectBtn = document.getElementById('connectBtn');
      const depositBtn = document.getElementById('depositBtn');
      const withdrawBtn = document.getElementById('withdrawBtn');
      const checkVaultBtn = document.getElementById('checkVaultBtn');
      const loadTasksBtn = document.getElementById('loadTasksBtn');
      const connectionStatus = document.getElementById('connectionStatus');
      const walletAddress = document.getElementById('walletAddress');
      const transferTypeSelect = document.getElementById('transferType');
      const recipientGroup = document.getElementById('recipientGroup');

      // Connect Wallet
      connectBtn.addEventListener('click', async () => {
        try {
          if (!window.ethereum) {
            alert('Please install MetaMask!');
            return;
          }

          connectBtn.innerHTML = 'Connecting... <span class="loading"></span>';
          connectBtn.disabled = true;

          // Request account access
          await window.ethereum.request({ method: 'eth_requestAccounts' });

          // Initialize SDK
          // const { PrivateTransferSDK } = await import('@zama-private-transfer/sdk');

          // For demo purposes, we'll simulate SDK initialization
          // sdk = new PrivateTransferSDK({
          //   contractAddress: '0x8ea2dDD9DD550d500B4cef4C560fE27cde37508D',
          // });
          // await sdk.initialize(window.ethereum);

          // Simulate connection
          const accounts = await window.ethereum.request({ method: 'eth_accounts' });
          const address = accounts[0];

          isConnected = true;
          connectionStatus.textContent = 'Connected';
          connectionStatus.className = 'status status-connected';
          walletAddress.textContent = `Address: ${address.slice(0, 6)}...${address.slice(-4)}`;

          // Enable buttons
          depositBtn.disabled = false;
          withdrawBtn.disabled = false;
          checkVaultBtn.disabled = false;
          loadTasksBtn.disabled = false;

          connectBtn.textContent = 'Connected';
          connectBtn.style.background = '#28a745';

          showSuccess('depositResult', 'Wallet connected successfully!');
        } catch (error) {
          showError('depositResult', error.message);
          connectBtn.disabled = false;
          connectBtn.textContent = 'Connect MetaMask';
        }
      });

      // Transfer Type Change
      transferTypeSelect.addEventListener('change', (e) => {
        const type = e.target.value;
        recipientGroup.style.display = type === '2' ? 'none' : 'block';
      });

      // Make Deposit
      depositBtn.addEventListener('click', async () => {
        try {
          const transferType = parseInt(transferTypeSelect.value);
          const amount = document.getElementById('depositAmount').value;
          const recipientAddress = document.getElementById('recipientAddress').value;

          if (!amount || parseFloat(amount) <= 0) {
            throw new Error('Please enter a valid amount');
          }

          if (transferType !== 2 && !recipientAddress) {
            throw new Error('Please enter recipient address');
          }

          depositBtn.innerHTML = 'Processing... <span class="loading"></span>';
          depositBtn.disabled = true;

          // In real implementation:
          // const result = await sdk.deposit({
          //   transferType,
          //   amount,
          //   recipientAddress: transferType === 2 ? undefined : recipientAddress,
          // });

          // Simulate deposit
          await new Promise((resolve) => setTimeout(resolve, 2000));

          const mockPasswordKey =
            '0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef';

          showSuccess(
            'depositResult',
            `
            <strong>‚úÖ Deposit Successful!</strong><br><br>
            <strong>‚ö†Ô∏è IMPORTANT - Save this password key:</strong><br>
            <code class="code">${mockPasswordKey}</code><br><br>
            <strong>You MUST save this key to withdraw your funds!</strong><br>
            Transaction: 0xabc...def
          `
          );

          depositBtn.disabled = false;
          depositBtn.textContent = 'Make Deposit';
        } catch (error) {
          showError('depositResult', error.message);
          depositBtn.disabled = false;
          depositBtn.textContent = 'Make Deposit';
        }
      });

      // Check Vault
      checkVaultBtn.addEventListener('click', async () => {
        try {
          const password = document.getElementById('withdrawPassword').value;

          if (!password) {
            throw new Error('Please enter your password');
          }

          checkVaultBtn.innerHTML = 'Checking... <span class="loading"></span>';
          checkVaultBtn.disabled = true;

          // In real implementation:
          // const vaultInfo = await sdk.getVaultInfo(password);

          // Simulate vault check
          await new Promise((resolve) => setTimeout(resolve, 1500));

          showSuccess(
            'withdrawResult',
            `
            <strong>Vault Information:</strong><br>
            Balance: 0.05 ETH<br>
            Transfer Type: Anyone with Password<br>
            Depositor: 0x123...abc<br>
            Recipient: 0x0000...0000
          `
          );

          checkVaultBtn.disabled = false;
          checkVaultBtn.textContent = 'Check Vault';
        } catch (error) {
          showError('withdrawResult', error.message);
          checkVaultBtn.disabled = false;
          checkVaultBtn.textContent = 'Check Vault';
        }
      });

      // Withdraw
      withdrawBtn.addEventListener('click', async () => {
        try {
          const password = document.getElementById('withdrawPassword').value;
          const amount = document.getElementById('withdrawAmount').value;

          if (!password) {
            throw new Error('Please enter your password');
          }

          if (!amount || parseFloat(amount) <= 0) {
            throw new Error('Please enter a valid amount');
          }

          withdrawBtn.innerHTML = 'Processing... <span class="loading"></span>';
          withdrawBtn.disabled = true;

          // In real implementation:
          // const result = await sdk.withdraw({ password, amount });

          // Simulate withdrawal
          await new Promise((resolve) => setTimeout(resolve, 2000));

          showSuccess(
            'withdrawResult',
            `
            <strong>‚úÖ Withdrawal Successful!</strong><br>
            Amount: ${amount} ETH<br>
            Transaction: 0xdef...123
          `
          );

          withdrawBtn.disabled = false;
          withdrawBtn.textContent = 'Withdraw';
        } catch (error) {
          showError('withdrawResult', error.message);
          withdrawBtn.disabled = false;
          withdrawBtn.textContent = 'Withdraw';
        }
      });

      // Load Tasks
      loadTasksBtn.addEventListener('click', async () => {
        try {
          loadTasksBtn.innerHTML = 'Loading... <span class="loading"></span>';
          loadTasksBtn.disabled = true;

          // In real implementation:
          // const tasks = await sdk.getBountyTasks();

          // Simulate task loading
          await new Promise((resolve) => setTimeout(resolve, 1500));

          const mockTasks = [
            { commission: '0.0050', totalReward: '0.0500' },
            { commission: '0.0100', totalReward: '0.1000' },
            { commission: '0.0025', totalReward: '0.0250' },
          ];

          let tasksHtml = '<strong>Available Bounty Tasks:</strong><br><br>';
          mockTasks.forEach((task, index) => {
            tasksHtml += `
            Task #${index + 1}:<br>
            - Total: ${task.totalReward} ETH<br>
            - Commission: ${task.commission} ETH<br><br>
          `;
          });

          showSuccess('tasksResult', tasksHtml);

          loadTasksBtn.disabled = false;
          loadTasksBtn.textContent = 'Load Available Tasks';
        } catch (error) {
          showError('tasksResult', error.message);
          loadTasksBtn.disabled = false;
          loadTasksBtn.textContent = 'Load Available Tasks';
        }
      });

      // Helper functions
      function showSuccess(elementId, message) {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="success-box">${message}</div>`;
      }

      function showError(elementId, message) {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="error-box"><strong>Error:</strong> ${message}</div>`;
      }

      function showWarning(elementId, message) {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="warning-box">${message}</div>`;
      }
    </script>
  </body>
</html>
