# 手动验证合约指南

## 合约信息
- **合约地址**: `0x8ea2dDD9DD550d500B4cef4C560fE27cde37508D`
- **网络**: Sepolia Testnet
- **合约名称**: `PrivateTransfer`

## 步骤 1: 访问验证页面

打开浏览器访问:
https://sepolia.etherscan.io/verifyContract?a=0x8ea2dDD9DD550d500B4cef4C560fE27cde37508D

## 步骤 2: 填写验证表单

### 2.1 Compiler Type
选择: **Solidity (Single file)**

### 2.2 Compiler Version
选择: **v0.8.27+commit.40a35a09**

### 2.3 Open Source License Type
选择: **3) MIT License**
(根据合约文件头部的 SPDX-License-Identifier)

点击 **Continue** 继续

## 步骤 3: 合约详细信息

### 3.1 Contract Address
自动填充: `0x8ea2dDD9DD550d500B4cef4C560fE27cde37508D`

### 3.2 Contract Name
填写: `PrivateTransfer`

### 3.3 Enter the Solidity Contract Code
需要粘贴展平后的合约代码。

**重要**: 文件位置在:
```
/home/ekko/Desktop/codes/zama-program/solidity/PrivateTransfer_flattened.sol
```

打开这个文件,复制全部内容粘贴到文本框中。

### 3.4 Optimization
选择: **Yes**

### 3.5 Runs (Optimizer)
填写: **800**

### 3.6 EVM Version
选择: **cancun**

### 3.7 Constructor Arguments ABI-encoded
需要编码构造函数参数。

你的构造函数参数是: `"PrivateTransfer"`

让我生成 ABI 编码:
```
0000000000000000000000000000000000000000000000000000000000000020
000000000000000000000000000000000000000000000000000000000000000f
5072697661746554726616e73666572000000000000000000000000000000000
```

**或者使用在线工具**:
1. 访问: https://abi.hashex.org/
2. 输入函数签名: `constructor(string)`
3. 输入参数值: `PrivateTransfer`
4. 点击 "Encode"
5. 复制生成的编码(去掉开头的 0x)

### 3.8 Contract Library Address (如果有)
留空 (此合约没有使用外部库)

## 步骤 4: 点击验证

点击 **Verify and Publish** 按钮

## 步骤 5: 确认成功

如果验证成功,你会看到:
- ✅ "Successfully generated ByteCode and ABI for Contract Address"
- 合约源码会显示在 Contract 标签页
- 会有绿色的 ✓ 验证标记

## 常见问题

### 问题 1: "Compiled contract mismatch"
**原因**: 编译设置不匹配

**解决方案**:
- 确认 Compiler Version 是 **v0.8.27**
- 确认 Optimization 是 **Yes**, Runs 是 **800**
- 确认 EVM Version 是 **cancun**

### 问题 2: "Constructor arguments invalid"
**原因**: 构造函数参数编码错误

**解决方案**:
使用以下命令生成正确的编码:
```bash
cast abi-encode "constructor(string)" "PrivateTransfer"
```

或使用 ethers.js:
```javascript
const ethers = require('ethers');
const encoded = ethers.AbiCoder.defaultAbiCoder().encode(
  ['string'],
  ['PrivateTransfer']
);
console.log(encoded.slice(2)); // 去掉 0x 前缀
```

### 问题 3: 导入路径问题
**原因**: 展平后的文件可能有重复的 SPDX 标识符

**解决方案**:
手动编辑 `PrivateTransfer_flattened.sol`:
1. 保留第一个 `// SPDX-License-Identifier: MIT`
2. 删除其他所有的 SPDX 行
3. 删除重复的 pragma 语句(只保留第一个)

## 快速生成构造函数参数编码

运行以下命令:
```bash
cd /home/ekko/Desktop/codes/zama-program/solidity
node -e "console.log(require('ethers').AbiCoder.defaultAbiCoder().encode(['string'], ['PrivateTransfer']).slice(2))"
```

这会输出 ABI 编码的构造函数参数。
